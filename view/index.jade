// @author Marenin Alex
// October 2013

!!! 5
html
    head
        title Video Chat
        style.
            #remote-video {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                z-index: 1;
            }

            #local-video {
                position: absolute;
                top: 10px;
                right: 10px;
                width: 240px;
                height: 160px;
                z-index: 2;
                border: 5px solid rgba(0, 0, 0, .5);
                border-radius: 4px;
                background-color: grey;
            }
        link(href='http://fonts.googleapis.com/css?family=Droid+Sans:400,700', rel='stylesheet', type='text/css')
        link(rel='stylesheet', href='public/css/bootstrap.css')
        link(rel='stylesheet', href='public/css/style.css')
        script(src='public/js/jquery.min.js')
        script(src='public/js/socket.io.min.js')
    body
        #video
            audio#remote-audio
            video#remote-video
            video#local-video

        #wrap
            #header
            .row.container
                .col-sm-3
                .col-sm-6
                    #buttons.dark-box.form-container
                        button#newRoom.btn.btn-success.btn-lg.btn-block New Room
                        button#openJoinRoomForm.btn.btn-success.btn-lg.btn-block Join Room
                    #joinRoomForm.dark-box.form-container
                        .form-group
                            label(for="roomName") Room Id
                            input#roomName.form-control.input-lg(type="text", placeholder="Enter Room Identifier")
                        .centered
                            button#join.btn.btn-success.btn-lg Join
                            button#rejectJoin.btn.btn-danger.btn-lg Cancel
        #footer
            .container Â©
                a(href='https://github.com/ioncreature', target='_blank') Alexander Marenin
        script.
            $( function(){
                var buttonsContainer = $( '#buttons' ),
                    videoContainer = $( '#video' ),
                    joinRoomForm = $( '#joinRoomForm' ),
                    buttonJoin = $( '#join' ),
                    roomName = $( '#roomName' );

                buttonsContainer.fadeIn();

                var room = new Room({
                    remoteVideo: document.getElementById('remote-video'),
                    localVideo: document.getElementById('local-video'),
                    remoteAudio: document.getElementById('remote-audio'),
                    socketUrl: '#{socketUrl}',
                    autoConnect: true,
                    iceServers: [{url: 'stun:stun.l.google.com:19302'}]
                });

                $( '#newRoom' ).click( function(){
                    buttonsContainer.fadeOut();
                    videoContainer.fadeIn();
                    room.createRoom( function( error ){
                        if ( error )
                            alert( error );
                    });
                });
                $( '#openJoinRoomForm' ).click( function(){
                    buttonsContainer.fadeOut( 300, function(){
                        joinRoomForm.fadeIn();
                    });
                });

                $( '#rejectJoin' ).click( function(){
                    joinRoomForm.fadeOut( 200, function(){
                        buttonsContainer.fadeIn();
                        roomName.trigger( 'change' );
                    });
                });

                buttonJoin.click( function(){
                    if ( roomName.val().trim() )
                        console.log( 'try to join room' );
                    else
                        roomName.closest( '.form-group' ).addClass( 'has-error' );
                });

                roomName.on( 'keydown keyup change', function(){
                    roomName.closest( '.form-group' ).removeClass( 'has-error' );
                });
            });
        script(src='public/js/bootstrap.min.js')
        script(src='public/js/main.js')
